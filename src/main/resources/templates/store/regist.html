<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Foogra - Discover & Book the best restaurants at the best price">
    <meta name="author" content="Ansonika">
    <title>Foogra - Discover & Book the best restaurants at the best price</title>

    <!-- Favicons-->
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="/img/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="/img/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="114x114" href="/img/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="144x144" href="/img/apple-touch-icon-144x144-precomposed.png">

     <!-- GOOGLE WEB FONT -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- BASE CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- SPECIFIC CSS -->
    <link href="/css/submit.css" rel="stylesheet">

    <!-- YOUR CUSTOM CSS -->
    <link href="/css/store-regist.css" rel="stylesheet">

</head>

<body>


	<!-- /header -->

	

		<!-- ❗regist.html용 Spring 연동 폼❗ -->

		<!-- form 태그 시작 -->
		<form method="post" action="/store/regist" enctype="multipart/form-data" id="register" autocomplete="off">
			<div class="card mb-4">
				<h2 class="form_title">가게 등록</h2>
				<div class="card-body">

					<!-- ① 이미지 업로드 -->
					<div id="image-upload-area" style="border: 2px dashed #ccc; padding: 40px 30px 30px 30px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;">
						<p id="upload-text" style="margin-top: 12px;">Drop files here to upload</p>
						<input type="file" id="image-input" name="storeMainImage" accept="image/*" style="display: none;" />
						<img id="preview-image" src="" style="max-width: 100%; display: none; margin-top: 10px;" />
						<input type="hidden" name="approvalStatus" value="WAITING" />
						<input type="hidden" name="operationStatus" value="TEMP_CLOSED" />
					</div>

					<!-- ② 가게명 / ③ 도로명 주소 API / ④ 전화번호 -->
					<div class="row mb-3">
					<div class="row mb-3">
						<div class="col-md-6 position-relative">
							<!-- 가게명 -->
							<input type="text" name="storeName" class="form-control mb-3" placeholder="가게명" required />
							<!-- 전화번호 -->
							<!-- 전화번호 -->
							<div class="form-group mb-0">
								<label for="phonePrefix" style="font-weight: normal;">전화번호</label>
								<div class="d-flex gap-2">
									<!-- 앞자리 선택 -->
									<select id="phonePrefix" name="phonePrefix" class="form-select" style="max-width: 100px;" required>
										<option value="" disabled selected>선택</option>
										<option value="02">02</option>
										<option value="031">031</option>
										<option value="032">032</option>
										<option value="042">042</option>
										<option value="051">051</option>
										<option value="053">053</option>
										<option value="062">062</option>
										<option value="041">041</option>
										<option value="043">043</option>
										<option value="054">054</option>
										<option value="055">055</option>
										<option value="061">061</option>
										<option value="063">063</option>
										<option value="044">044</option>
										<option value="010">010</option>
										<option value="011">011</option>
										<!-- 필요한 번호 추가 -->
									</select>

									<!-- 나머지 번호 입력 -->
									<input type="text" id="phoneRest" name="phoneRest" class="form-control" placeholder="1234-5678" maxlength="9" required />
								</div>
								<!-- 합친 전화번호를 form submit 시 hidden 필드로 만들기 -->
								<input type="hidden" id="phone" name="phone" />
							</div>
						</div>

						<div class="col-md-6 position-relative">
							<!-- 주소 입력 영역 -->
							<div class="address-group">
								<!-- 도로명 주소 -->
								<input type="text" id="address-api" name="address" class="form-control" placeholder="도로명 주소" readonly />
								<!-- 우편번호 (hidden) -->
								<input type="hidden" id="zipcode" name="zipcode" />
								<!-- 상세주소 -->
								<input
										type="text"
										id="store_detail_input"
										name="store_detail_input"
										class="form-control mt-2"
										placeholder="상세 주소 입력"
										autocomplete="off"
										autocorrect="off"
										spellcheck="false"
										inputmode="text"
								/>

								<!-- 숨김 필드: 위도, 경도, 법정코드 -->
								<input type="hidden" id="storeLat" name="storeLat" />
								<input type="hidden" id="storeLng" name="storeLng" />
								<input type="hidden" id="storeLegalCode" name="storeLegalCode" />

								<!-- 주소 검색 버튼 -->
								<button type="button" class="btn mt-2" id="searchAddressBtn" style="background-color: #f39c12; color: white; border: none;">
									주소 검색
								</button>
							</div>
						</div>
					</div>

				<!-- ⑤ 요일별 영업시간 -->
						<div class="box_general padding_bottom">
							<div class="header_box version_2">
								<h2><i class="fa fa-clock-o"></i>Opening Hours</h2>
							</div>
							<div id="opening-schedule"></div>
						</div>

					<!-- ⑥ 지역카드, 유아 동반, 주차 : 라디오 · 체크박스 -->
					<div class="mb-4">

						<!-- 지역카드 사용 가능 -->
						<div class="form-check d-inline-block me-4" style="vertical-align: middle;">
							<input type="hidden" name="isLocalCard" value="false" />
							<input type="checkbox" id="regionCardCheck" name="isLocalCard" class="form-check-input" value="true" />
							<label for="regionCardCheck" class="form-check-label">지역카드 사용 가능</label>
						</div>

						<!-- 유아 동반 가능 -->
						<div class="form-check d-inline-block me-4" style="vertical-align: middle;">
							<input class="form-check-input" type="checkbox" name="isChildAllowed" value="true" id="childAllowed">
							<label class="form-check-label" for="childAllowed">유아 동반 가능</label>
						</div>

						<!-- 주차 -->
						<div class="mt-3">
							<label class="form-label me-3">주차</label>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="hasParking" id="parkingFree" value="FREE">
								<label class="form-check-label" for="parkingFree">무료</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="hasParking" id="parkingPaid" value="PAID">
								<label class="form-check-label" for="parkingPaid">유료</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="hasParking" id="parkingNone" value="NOT_AVAILABLE">
								<label class="form-check-label" for="parkingNone">불가</label>
							</div>
						</div>

					</div>

						<!-- ⑦ 사장님 한 줄 소개 -->
						<div class="owner-intro-wrapper" style="width: 100%;">
							<label for="owner-intro" style="font-weight: bold; color: #2c3e50;">
								사장님 한 줄 소개
							</label>
							<textarea
									id="owner-intro"
									name="ownerComment"
									class="form-control"
									rows="8"
									placeholder="매장 소개를 적어주세요.
												• 주말/공휴일 영업 여부
												• 유료 주차 안내 (ex: 1시간당 2,000원)"
									style="white-space: pre-line; line-height: 1.5; height: 140px;"
							></textarea>

							<div id="owner-intro-hint"
								 style="
									margin-top: 8px;
									color: #888;
									font-size: 0.9em;
									user-select: none;
									white-space: pre-line;
									line-height: 1.3;
									transition: opacity 0.3s ease;
									opacity: 1;
								"
							>
							</div>
						</div>

					<hr>
					<h6 class="mb-3">메뉴 등록</h6>
					<div id="menu-items">
						<div class="menu-item row align-items-center mb-4">
							<!-- 이미지 업로드 -->
							<div class="col-md-4">
								<div class="menu-image-upload" style="border: 2px dashed #ccc; padding: 30px 20px; text-align: center; cursor: pointer; height: 180px;">
									<p style="margin-top: 10px;">Drop files here to upload</p>
									<input type="file" name="menus[0].menuImageFile" class="menu-image-input" accept="image/*" style="display: none;" />
									<img class="menu-preview-image" src="" style="max-width: 100%; max-height: 120px; display: none; margin-top: 10px;" />
								</div>
							</div>

							<!-- 메뉴 정보 -->
							<div class="col-md-8">
								<div class="row">
									<!-- 메뉴명 -->
									<div class="col-md-4">
										<input type="text" name="menus[0].menuName" class="form-control" placeholder="메뉴 이름" required />
									</div>

									<!-- 가격 -->
									<div class="col-md-6 mb-2">
										<div class="input-group">
											<input type="number" name="menus[0].price" class="form-control" placeholder="가격" min="0" step="500" required>
											<span class="input-group-text">원</span>
										</div>
									</div>

									<!-- 카테고리 선택 및 육수 선택 묶음 -->
									<div class="col-md-8 mb-2 d-flex gap-2">
										<!-- 카테고리 드롭다운 -->
										<select name="menus[0].ramenCategoryId" class="form-select form-select-sm scrollable-select" style="flex: 1;">
											<option disabled selected>카테고리 선택</option>
											<option value="돈코츠">돈코츠 (Tonkotsu, 돼지뼈 육수)</option>
											<option value="쇼유">쇼유 (Shoyu, 간장 베이스)</option>
											<option value="미소">미소 (Miso, 된장 베이스)</option>
											<option value="시오">시오 (Shio, 소금 베이스)</option>
											<option value="카레">카레 (Curry 라멘)</option>
											<option value="츠케멘">츠케멘 (찍먹 스타일)</option>
											<option value="탄탄멘">탄탄멘 (Spicy sesame)</option>
											<option value="사케라멘">사케라멘 (해산물 베이스)</option>
											<option value="마제소바">마제소바 (비빔면 스타일)</option>
										</select>

										<!-- 육수 선택 드롭다운 -->
										<select name="menus[0].ramenSoupId" class="form-select form-select-sm scrollable-select" style="flex: 1;">
											<option disabled selected>육수 선택</option>
											<option value="1">돈코츠 (돼지뼈)</option>
											<option value="2">소유 (간장)</option>
											<option value="3">미소 (된장)</option>
											<option value="4">시오 (소금)</option>
											<option value="4">토리파이탄 (닭육수)</option>
											<option value="4">가츠오부시 (가다랑어포)</option>
											<option value="4">콘부 (다시마)</option>
											<option value="4">해산물 베이스</option>
										</select>
									</div>

									<!-- 메뉴 설명 + 기본 토핑 -->
									<div class="col-md-12 mb-2 d-flex gap-3 align-items-start">
										<!-- 메뉴 설명 -->
										<div class="col-md-6 mt-2">
											<textarea name="menus[0].menuDescription" class="form-control" rows="2" placeholder="설명"></textarea>
										</div>

										<!-- 기본 토핑 선택 -->
										<div>
											<label class="form-label d-block">기본 토핑 선택</label>
											<div class="topping-tags" data-menu-index="0">
												<span class="topping-tag" data-id="1" data-name="차슈">차슈</span>
												<span class="topping-tag" data-id="2" data-name="닭가슴살">닭가슴살</span>
												<span class="topping-tag" data-id="3" data-name="반숙 계란">반숙 계란</span>
												<span class="topping-tag" data-id="4" data-name="파">파</span>
												<span class="topping-tag" data-id="5" data-name="김">김</span>
												<span class="topping-tag" data-id="6" data-name="멘마">멘마</span>
												<span class="topping-tag" data-id="7" data-name="숙주">숙주</span>
												<span class="topping-tag" data-id="8" data-name="버터">버터</span>
												<span class="topping-tag" data-id="9" data-name="옥수수">옥수수</span>
												<span class="topping-tag" data-id="10" data-name="김치">김치</span>
												<span class="topping-tag" data-id="11" data-name="생강">생강</span>
												<span class="topping-tag" data-id="12" data-name="마늘">마늘</span>
												<span class="topping-tag" data-id="13" data-name="치즈">치즈</span>
												<span class="topping-tag" data-id="14" data-name="매운 고추">매운 고추</span>
												<span class="topping-tag" data-id="15" data-name="새우튀김">새우튀김</span>
												<span class="topping-tag" data-id="16" data-name="두부">두부</span>
												<span class="topping-tag" data-id="17" data-name="시금치">시금치</span>
												<span class="topping-tag" data-id="18" data-name="팽이버섯">팽이버섯</span>
												<span class="topping-tag" data-id="19" data-name="고추기름">고추기름</span>
												<span class="topping-tag" data-id="20" data-name="텐카스">텐카스</span>
											</div>
											<div class="default-toppings-container"></div>
										</div>
									</div>

									<!---->

<!--									<input type="hidden" id="storeLat" name="storeLat">-->
<!--									<input type="hidden" id="storeLng" name="storeLng">-->
<!--									<input type="hidden" id="storeLegalCode" name="storeLegalCode">-->


									<!---->

									<!-- 추가 토핑 입력 -->
									<!-- 추가 토핑 입력 컨테이너 -->
									<div id="extra-toppings-container-0" style="display: none;">
										<div class="extra-topping-item d-flex align-items-center mb-2">
											<input type="text" name="menus[0].extraToppings[0]" class="form-control form-control-sm" placeholder="추가 토핑 (예: 매운 멘마)">
											<button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeExtraTopping(this)">삭제</button>
										</div>
									</div>

									<button type="button" class="btn btn-sm btn-outline-secondary add-extra-topping" style="width: 80px;">+ 추가 토핑</button>

									<!-- 삭제 버튼 -->
									<div class="col-12 text-end">
										<button type="button" class="btn btn-sm btn-outline-danger remove-menu">삭제</button>
									</div>
								</div>
							</div>
						</div>
					<button type="button" id="add-menu" class="btn btn-sm btn-outline-primary mb-4">+ 메뉴 추가</button>

						<!-- 제출 버튼 -->
						<div class="text-center">
							<button type="submit" class="btn btn-success btn-lg">등록하기</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>

	<!--/footer-->








	<!-- COMMON SCRIPTS -->
    <script src="/js/common_scripts.min.js"></script>
    <script src="/js/common_func.js"></script>
    <script src="/assets/validate.js"></script>

	<!-- ❗JS 스크립트 ❗ -->

	<!-- 카카오 다음 우편번호 API 스크립트 -->
	<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js" charset="utf-8"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d8455fa8f84607ce70b0cd1184c74538&libraries=services"></script>

	<script>
		/* ========== 주소 검색 (카카오) ========== */
		function openPostcode() {
			new daum.Postcode({
				oncomplete: function (data) {
					const roadAddress = data.roadAddress;
					const zonecode = data.zonecode;

					document.getElementById("address-api").value = roadAddress;
					document.getElementById("zipcode").value = zonecode;
					document.getElementById("store_detail_input").focus();

					fetch("/location/info", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ roadAddress })
					})
							.then(res => res.json())
							.then(data => {
								document.getElementById("storeLat").value = data.storeLat || '';
								document.getElementById("storeLng").value = data.storeLng || '';
								document.getElementById("storeLegalCode").value = data.storeLegalCode || '';
							})
							.catch(err => console.error("주소 정보 조회 실패:", err));
				}
			}).open();
		}
		document.getElementById("searchAddressBtn").addEventListener("click", openPostcode);
		document.getElementById("address-api").addEventListener("click", openPostcode);


		/* ========== 전화번호 입력 처리 ========== */
		const phonePrefix = document.getElementById('phonePrefix');
		const phoneRest = document.getElementById('phoneRest');
		const phoneHidden = document.getElementById('phone');

		phoneRest.addEventListener('input', e => {
			let val = e.target.value.replace(/[^0-9]/g, '');
			if (val.length > 4) val = val.slice(0, 4) + '-' + val.slice(4, 8);
			e.target.value = val;
		});

		/* ========== 등록 전 유효성 검사 ========== */
		document.getElementById('register').addEventListener('submit', e => {
			let isValid = true;
			const menus = document.querySelectorAll('.menu-item');

			menus.forEach((menu, i) => {
				const menuName = menu.querySelector(`[name="menus[${i}].menuName"]`);
				const price = menu.querySelector(`[name="menus[${i}].price"]`);
				const category = menu.querySelector(`[name="menus[${i}].ramenCategoryId"]`);
				const soup = menu.querySelector(`[name="menus[${i}].ramenSoupId"]`);

				const phonePrefix = document.getElementById('phonePrefix');
				const phoneRest = document.getElementById('phoneRest');
				const phoneHidden = document.getElementById('phone');

				phoneHidden.value = phonePrefix.value + '-' + phoneRest.value;

				if (!menuName.value.trim()) {
					alert(`메뉴 이름을 입력해주세요. (메뉴 ${i+1})`);
					menuName.focus();
					e.preventDefault();
					return false;
				}
				if (!price.value || price.value <= 0) {
					alert(`가격을 입력해주세요. (메뉴 ${i+1})`);
					price.focus();
					e.preventDefault();
					return false;
				}
				if (!category.value) {
					alert(`카테고리를 선택해주세요. (메뉴 ${i+1})`);
					category.focus();
					e.preventDefault();
					return false;
				}
				if (!soup.value) {
					alert(`육수를 선택해주세요. (메뉴 ${i+1})`);
					soup.focus();
					e.preventDefault();
					return false;
				}
			});

			if (!phonePrefix.value) {
				alert('전화번호 앞자리를 입력해주세요.');
				phonePrefix.focus();
				e.preventDefault();
				return false;
			}
			if (!phoneRest.value || phoneRest.value.replace(/-/g, '').length < 7) {
				alert('전화번호 뒷자리를 확인해주세요.');
				phoneRest.focus();
				e.preventDefault();
				return false;
			}
		});


		/* ========== 대표 이미지 업로드 미리보기 ========== */
		document.getElementById('image-upload-area').addEventListener('click', () => {
			document.getElementById('image-input').click();
		});

		document.getElementById('image-input').addEventListener('change', event => {
			const file = event.target.files[0];
			const preview = document.getElementById('preview-image');
			const uploadText = document.getElementById('upload-text');
			if (file) {
				const reader = new FileReader();
				reader.onload = e => {
					preview.src = e.target.result;
					preview.style.display = 'block';
					uploadText.style.display = 'none';
				};
				reader.readAsDataURL(file);
			}
		});

		let menuIndex = 1;
		const menuList = document.getElementById('menu-items');
		const template = document.querySelector('.menu-item');
		const addButton = document.getElementById('add-menu');

		/* ========== 메뉴 추가 버튼 클릭 시 ========== */
		addButton.addEventListener('click', () => {
			const clone = template.cloneNode(true);

			// name, id, value 초기화
			clone.querySelectorAll('input, select, textarea').forEach(input => {
				if (input.name) input.name = input.name.replace(/\d+/, menuIndex);
				if (input.id) {
					const newId = input.id.replace(/\d+/, menuIndex);
					const label = clone.querySelector(`label[for="${input.id}"]`);
					input.id = newId;
					if (label) label.setAttribute("for", newId);
				}
				if (input.type === 'checkbox' || input.type === 'radio') input.checked = false;
				else input.value = '';
			});

			// 토핑 관련 인덱스 업데이트
			clone.querySelectorAll('.topping-tags, .default-toppings-container').forEach(el => {
				el.dataset.menuIndex = menuIndex;
			});

			// extra-toppings-container ID 수정
			const extraContainer = clone.querySelector('[id^="extra-toppings-container-"]');
			if (extraContainer) extraContainer.id = `extra-toppings-container-${menuIndex}`;

			// 기능 재등록
			setupMenuImageUpload(clone);
			setupToppingTags(clone);
			setupExtraToppingButtons(clone);
			updateRemoveMenuButtons(clone);

			menuList.insertBefore(clone, addButton);
			menuIndex++;
		});

		/* ========== 메뉴 삭제 버튼 클릭 시 ========== */
		function updateRemoveMenuButtons(context = document) {
			context.querySelectorAll('.remove-menu').forEach(button => {
				button.onclick = () => {
					const allMenus = document.querySelectorAll('.menu-item');
					if (allMenus.length > 1) {
						button.closest('.menu-item').remove();
						updateMenuIndices(); // 인덱스 재정렬
					} else {
						alert("최소 한 개의 메뉴는 등록되어 있어야 합니다.");
					}
				};
			});
		}

		/* ========== 메뉴 인덱스 전체 재정렬 ========== */
		function updateMenuIndices() {
			const menus = document.querySelectorAll('.menu-item');
			menus.forEach((menu, i) => {
				menu.querySelectorAll('input, select, textarea').forEach(input => {
					if (input.name) input.name = input.name.replace(/\[\d+\]/, `[${i}]`);
				});
				menu.querySelectorAll('.topping-tags, .default-toppings-container').forEach(el => {
					el.dataset.menuIndex = i;
				});
				const extraContainer = menu.querySelector('[id^="extra-toppings-container-"]');
				if (extraContainer) extraContainer.id = `extra-toppings-container-${i}`;
			});
			setupToppingTags(); // 토핑 이벤트 재연결
			setupExtraToppingButtons(); // 추가 토핑 이벤트 재연결
		}

		/* ========== 기본 토핑 선택 기능 ========== */
		function setupToppingTags(context = document) {
			const target = context === document ? document : context;
			target.querySelectorAll('.topping-tag').forEach(tag => {
				tag.onclick = () => {
					tag.classList.toggle('selected');

					const menuItem = tag.closest('.menu-item');
					const menuIndex = menuItem.querySelector('.topping-tags').dataset.menuIndex;
					const toppingId = tag.dataset.id;
					const defaultContainer = menuItem.querySelector('.default-toppings-container');

					const existing = defaultContainer.querySelector(`input[value="${toppingId}"]`);

					if (tag.classList.contains('selected')) {
						if (!existing) {
							const input = document.createElement('input');
							input.type = 'hidden';
							input.name = `menus[${menuIndex}].defaultToppingIds`;
							input.value = toppingId;
							defaultContainer.appendChild(input);
						}
					} else {
						if (existing) defaultContainer.removeChild(existing);
					}
				};
			});
		}

		/* ========== 추가 토핑 버튼 연결 ========== */
		function setupExtraToppingButtons(context = document) {
			context.querySelectorAll('.add-extra-topping').forEach(button => {
				button.onclick = () => {
					const menuItem = button.closest('.menu-item');
					const menus = Array.from(document.querySelectorAll('.menu-item'));
					const menuIndex = menus.indexOf(menuItem);
					addExtraTopping(menuIndex);
				};
			});
		}

		/* ========== 추가 토핑 입력 필드 추가 ========== */
		function addExtraTopping(menuIndex) {
			const container = document.getElementById(`extra-toppings-container-${menuIndex}`);
			if (!container) return;

			if (container.style.display === 'none') {
				container.style.display = 'block';
				if (container.querySelectorAll('.extra-topping-item').length > 0) return;
			}

			const count = container.querySelectorAll('input').length;
			const wrapper = document.createElement('div');
			wrapper.className = 'extra-topping-item d-flex align-items-center mb-2';

			const input = document.createElement('input');
			input.type = 'text';
			input.name = `menus[${menuIndex}].extraToppings[${count}]`;
			input.className = 'form-control form-control-sm';
			input.placeholder = '추가 토핑 (예: 매운 멘마)';

			const btn = document.createElement('button');
			btn.type = 'button';
			btn.className = 'btn btn-sm btn-outline-danger ms-2';
			btn.textContent = '삭제';
			btn.onclick = () => container.removeChild(wrapper);

			wrapper.appendChild(input);
			wrapper.appendChild(btn);
			container.appendChild(wrapper);
		}

		/* ========== 메뉴 이미지 업로드 기능 ========== */
		function setupMenuImageUpload(area) {
			const uploadArea = area.querySelector('.menu-image-upload');
			const input = uploadArea.querySelector('.menu-image-input');
			const preview = uploadArea.querySelector('.menu-preview-image');
			const uploadText = uploadArea.querySelector('p');

			uploadArea.addEventListener('click', () => input.click());

			['dragover', 'dragleave'].forEach(evt =>
					uploadArea.addEventListener(evt, e => {
						e.preventDefault();
						uploadArea.style.borderColor = evt === 'dragover' ? '#007bff' : '#ccc';
					})
			);

			uploadArea.addEventListener('drop', e => {
				e.preventDefault();
				uploadArea.style.borderColor = '#ccc';
				const file = e.dataTransfer.files[0];
				if (file) {
					input.files = e.dataTransfer.files;
					preview.src = URL.createObjectURL(file);
					preview.style.display = 'block';
					uploadText.style.display = 'none';
				}
			});

			input.addEventListener('change', () => {
				const file = input.files[0];
				if (file) {
					preview.src = URL.createObjectURL(file);
					preview.style.display = 'block';
					uploadText.style.display = 'none';
				}
			});
		}

		/* ========== 초기 실행 ========== */
		updateRemoveMenuButtons();
		setupToppingTags();
		setupExtraToppingButtons();
		setupMenuImageUpload(document);

		/* ========== 한 줄 소개 ========== */
		const textarea = document.getElementById('owner-intro');
		const wrapper = textarea.closest('.owner-intro-wrapper');

		function toggleHint() {
			if (textarea.value.trim().length > 0) {
				wrapper.classList.add('text-filled');
			} else {
				wrapper.classList.remove('text-filled');
			}
		}
		textarea.addEventListener('input', toggleHint);
		window.addEventListener('DOMContentLoaded', toggleHint);


		/* ========== 지역카드 체크 처리 ========== */
		document.querySelector("form").addEventListener("submit", function () {
			const regionCard = document.getElementById("regionCardCheck");
			if (!regionCard.checked) {
				const hiddenInput = document.createElement("input");
				hiddenInput.type = "hidden";
				hiddenInput.name = "isLocalCard";
				hiddenInput.value = "false";
				this.appendChild(hiddenInput);
			}
		});

		/* ========== 요일별 영업시간 ========== */
		const days = ["MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"];
		const dayLabels = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

		function generateTimeOptions() {
			const options = [];
			for (let h = 0; h < 24; h++) {
				const hour = h % 12 === 0 ? 12 : h % 12;
				const meridian = h < 12 ? "AM" : "PM";
				const value = `${h.toString().padStart(2, '0')}:00`;
				const label = `${hour} ${meridian}`;
				options.push(`<option value="${value}">${label}</option>`);
			}
			return options.join("");
		}

		function checkClosed(index) {
			const open = document.querySelector(`[name="weekSchedule[${index}].openingAt"]`);
			const close = document.querySelector(`[name="weekSchedule[${index}].closingAt"]`);
			const closedInput = document.getElementById(`closed-day-${index}`);

			if (open.value === "CLOSED" || close.value === "CLOSED") {
				closedInput.value = "true";
				open.disabled = true;
				close.disabled = true;
			} else {
				closedInput.value = "false";
				open.disabled = false;
				close.disabled = false;
			}
		}

		function renderOpeningSchedule() {
			const container = document.getElementById("opening-schedule");
			let html = "";
			for (let i = 0; i < days.length; i++) {
				html += `
        <div class="row mb-2 align-items-center">
            <div class="col-md-2">
                <label class="fix_spacing">${dayLabels[i]}</label>
                <input type="hidden" name="weekSchedule[${i}].dayOfWeek" value="${days[i]}">
                <input type="hidden" name="weekSchedule[${i}].isClosedDay" value="false" id="closed-day-${i}">
            </div>
            <div class="col-md-5">
                <select class="form-control" name="weekSchedule[${i}].openingAt" onchange="checkClosed(${i})">
                    <option value="">Opening Time</option>
                    <option value="CLOSED">Closed</option>
                    ${generateTimeOptions()}
                </select>
            </div>
            <div class="col-md-5">
                <select class="form-control" name="weekSchedule[${i}].closingAt" onchange="checkClosed(${i})">
                    <option value="">Closing Time</option>
                    <option value="CLOSED">Closed</option>
                    ${generateTimeOptions()}
                </select>
            </div>
        </div>`;
			}
			container.innerHTML = html;
		}
		document.addEventListener("DOMContentLoaded", renderOpeningSchedule);
	</script>

</body>
</html>