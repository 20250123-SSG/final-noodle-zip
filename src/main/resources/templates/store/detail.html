<!DOCTYPE html>
<html lang="en"
			xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{store/head :: head}"></head>

<style>
	.menu_header {
		margin-bottom: 2rem;
	}

	.menu_title {
		font-size: 2rem;
		font-weight: 700;
		margin-bottom: 1rem;
		color: #333333; /* 진한 회색 텍스트 */
	}

	.filter-bar {
		display: flex;
		flex-wrap: wrap;
		gap: 1rem;
		align-items: center;
	}

	.tag-group {
		display: flex;
		align-items: center;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	.filter-label {
		font-weight: 600;
		margin-right: 0.5rem;
		color: #777777; /* 중간 회색 */
	}

	.filter-tag {
		display: inline-block;
		padding: 0.3em 0.8em;
		border-radius: 999px;
		background-color: #f2f2f2; /* 연한 회색 */
		color: #222222; /* 거의 검은색 */
		cursor: pointer;
		transition: background-color 0.2s ease, opacity 0.2s ease;
		font-size: 0.875rem;
		border: 1px solid #cccccc;
	}

	.filter-tag:hover {
		background-color: #e0e0e0;
	}

	.filter-tag.inactive {
		opacity: 0.4;
		background-color: #dddddd;
	}


	.menu_card {
		display: flex;
		align-items: flex-start;
		border: 1px solid #ededed;
		border-radius: 3px;
		padding: 20px;
		margin-bottom: 20px;
		background-color: #fff;
		box-shadow: 0 2px 4px rgba(3, 27, 78, 0.06);
	}

	.menu_thumb {
		width: 100px;
		height: 100px;
		border-radius: 3px;
		overflow: hidden;
		flex-shrink: 0;
		margin-right: 20px;
	}

	.menu_thumb img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}

	.menu_info {
		flex: 1;
	}

	.menu_info h4 {
		margin: 0 0 8px;
		font-size: 16px;
		font-weight: 500;
		color: #222;
	}

	.menu_info em {
		float: right;
		font-weight: 500;
		color: #589442;
	}

	.menu_info p {
		margin: 8px 0 0;
		color: #555;
		font-size: 14px;
		line-height: 1.5;
	}

	.menu_meta {
		margin-top: 8px;
	}

	.menu_meta .tag {
		display: inline-block;
		margin-right: 6px;
		padding: 2px 8px;
		font-size: 12px;
		background-color: #f5f5f5;
		color: #333;
		border-radius: 3px;
	}

</style>

<body>
	<!-- header -->
	<th:block th:replace="~{store/header :: header}"></th:block>

	<main>
		
		<div class="container margin_detail">
		    <div class="row">
		        <div class="col-lg-8">
		            <div class="detail_page_head clearfix">
		                <div class="breadcrumbs">
		                    <ul>
		                        <li><a href="#">Home</a></li>
		                        <li><a href="#">Category</a></li>
		                        <li>Page active</li>
		                    </ul>
		                </div>
		                <div class="title">
		                    <h1 th:text="${store.storeName}">매장명</h1>
											<span th:text="${store.address}">주소</span>
											<a th:href="'https://map.naver.com/v5/search/' + ${store.storeName} + '?c=' + ${store.storeLng} + ',' + ${store.storeLat} + ',16,0,0'"
												 target="_blank">
												네이버 지도로 길찾기
											</a>
		                    <ul class="tags">
		                        <li><a href="#0">Pizza</a></li>
		                        <li><a href="#0">Italian Food</a></li>
		                        <li><a href="#0">Best Price</a></li>
		                    </ul>
		                </div>
									<!-- 이거 뭘로 바꾸지 -->
		                <div class="rating">
		                    <div class="score"><span>Superb<em>350 Reviews</em></span><strong>8.9</strong></div>
		                </div>
		            </div>
		            <!-- /detail_page_head -->

		            <div class="owl-carousel owl-theme carousel_1 magnific-gallery">
		                <div class="item">
		                    <a th:href="${store.storeMainImageUrl}" title="매장사진" data-effect="mfp-zoom-in">
													<img th:src="${store.storeMainImageUrl != null ? store.storeMainImageUrl : '/img/no-image.png'}" alt="store image">
												</a>
		                </div>
		            </div>
		            <!-- /carousel -->

		            <div class="tabs_detail">
		                <ul class="nav nav-tabs" role="tablist">
		                    <li class="nav-item">
		                        <a id="tab-A" href="#pane-A" class="nav-link active" data-bs-toggle="tab" role="tab">Information</a>
		                    </li>
												<li class="nav-item">
													<a id="tab-C" href="#pane-C" class="nav-link" data-bs-toggle="tab" role="tab">Menus</a>
												</li>
		                    <li class="nav-item">
		                        <a id="tab-B" href="#pane-B" class="nav-link" data-bs-toggle="tab" role="tab">Reviews</a>
		                    </li>
		                </ul>

		                <div class="tab-content" role="tablist">
		                    <div id="pane-A" class="card tab-pane fade show active" role="tabpanel" aria-labelledby="tab-A">
		                        <div class="card-header" role="tab" id="heading-A">
		                            <h5>
		                                <a class="collapsed" data-bs-toggle="collapse" href="#collapse-A" aria-expanded="true" aria-controls="collapse-A">
		                                    Information
		                                </a>
		                            </h5>
		                        </div>
		                        <div id="collapse-A" class="collapse" role="tabpanel" aria-labelledby="heading-A">
		                            <div class="card-body info_content">
		                                <h2 th:text="${store.storeName} + ' 정보'">Store Info</h2>
		                                <h3>기본정보</h3>
		                                <div class="menu_item">
		                                    <em>전화번호</em>
		                                    <h4>매장 전화번호</h4>
		                                    <p th:text="${store.phone}">phone number</p>
		                                </div>
		                                <div class="menu_item">
		                                    <em>주소</em>
		                                    <h4>매장 주소</h4>
		                                    <p th:text="${store.address}">address</p>
		                                </div>
		                                <hr>
		                                <h3>편의사항</h3>
		                                <div class="menu_item">
		                                    <em>local card</em>
		                                    <h4>지역카드</h4>
		                                    <p th:text="${store.isLocalCard}">가능여부</p>
		                                </div>
		                                <div class="menu_item">
		                                    <em>child</em>
		                                    <h4>유아동반</h4>
		                                    <p th:text="${store.isChildAllowed}">가능여부</p>
		                                </div>
		                                <div class="menu_item">
		                                    <em>parking</em>
		                                    <h4>주차여부</h4>
		                                    <p th:text="${store.hasParking}">가능여부</p>
		                                </div>
		                                <hr>
		                                <h3>매장소개</h3>
		                                <div class="menu_item">
		                                    <em></em>
		                                    <h4>사장님 한마디</h4>
		                                    <p th:text="${store.ownerComment}">한마디</p>
		                                </div>

		                            </div>
		                        </div>
		                    </div>
		                    <!-- /tab -->



											<input type="hidden" id="store-id" th:value="${store.id}">
											<div class="tab-pane fade" id="pane-C" role="tabpanel" aria-labelledby="tab-C"></div>
												<!-- tab-menu fragment -->



		                    <div id="pane-B" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-B">
		                        <div class="card-header" role="tab" id="heading-B">
		                            <h5>
		                                <a class="collapsed" data-bs-toggle="collapse" href="#collapse-B" aria-expanded="false" aria-controls="collapse-B">
		                                    Reviews
		                                </a>
		                            </h5>
		                        </div>
		                        <div id="collapse-B" class="collapse" role="tabpanel" aria-labelledby="heading-B">
		                            <div class="card-body reviews">
		                                <div class="row add_bottom_45 d-flex align-items-center">
		                                    <div class="col-md-3">
		                                        <div id="review_summary">
		                                            <strong>8.5</strong>
		                                            <em>Superb</em>
		                                            <small>Based on 4 reviews</small>
		                                        </div>
		                                    </div>
		                                    <div class="col-md-9 reviews_sum_details">
		                                        <div class="row">
		                                            <div class="col-md-6">
		                                                <h6>Food Quality</h6>
		                                                <div class="row">
		                                                    <div class="col-xl-10 col-lg-9 col-9">
		                                                        <div class="progress">
		                                                            <div class="progress-bar" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
		                                                        </div>
		                                                    </div>
		                                                    <div class="col-xl-2 col-lg-3 col-3"><strong>9.0</strong></div>
		                                                </div>
		                                                <!-- /row -->
		                                                <h6>Service</h6>
		                                                <div class="row">
		                                                    <div class="col-xl-10 col-lg-9 col-9">
		                                                        <div class="progress">
		                                                            <div class="progress-bar" role="progressbar" style="width: 95%" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100"></div>
		                                                        </div>
		                                                    </div>
		                                                    <div class="col-xl-2 col-lg-3 col-3"><strong>9.5</strong></div>
		                                                </div>
		                                                <!-- /row -->
		                                            </div>
		                                            <div class="col-md-6">
		                                                <h6>Location</h6>
		                                                <div class="row">
		                                                    <div class="col-xl-10 col-lg-9 col-9">
		                                                        <div class="progress">
		                                                            <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
		                                                        </div>
		                                                    </div>
		                                                    <div class="col-xl-2 col-lg-3 col-3"><strong>6.0</strong></div>
		                                                </div>
		                                                <!-- /row -->
		                                                <h6>Price</h6>
		                                                <div class="row">
		                                                    <div class="col-xl-10 col-lg-9 col-9">
		                                                        <div class="progress">
		                                                            <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
		                                                        </div>
		                                                    </div>
		                                                    <div class="col-xl-2 col-lg-3 col-3"><strong>6.0</strong></div>
		                                                </div>
		                                                <!-- /row -->
		                                            </div>
		                                        </div>
		                                        <!-- /row -->
		                                    </div>
		                                </div>

		                                <div id="reviews">

		                                    <!-- /review_card -->
		                                    <div class="review_card">
		                                        <div class="row">
		                                            <div class="col-md-2 user_info">
		                                                <figure><img src="/img/avatar1.jpg" alt=""></figure>
		                                                <h5>Marika</h5>
		                                            </div>
		                                            <div class="col-md-10 review_content">
		                                                <div class="clearfix add_bottom_15">
		                                                    <span class="rating">9.0<small>/10</small> <strong>Rating average</strong></span>
		                                                    <em>Published 11 Oct. 2019</em>
		                                                </div>
		                                                <h4>"Really great dinner!!"</h4>
		                                                <p>Eos tollit ancillae ea, lorem consulatu qui ne, eu eros eirmod scaevola sea. Et nec tantas accusamus salutatus, sit commodo veritus te, erat legere fabulas has ut. Rebum laudem cum ea, ius essent fuisset ut. Viderer petentium cu his. Tollit molestie suscipiantur his et.</p>
		                                                <ul>
		                                                    <li><a href="#0"><i class="icon_like"></i><span>Useful</span></a></li>
		                                                    <li><a href="#0"><i class="icon_dislike"></i><span>Not useful</span></a></li>
		                                                    <li><a href="#0"><i class="arrow_back"></i> <span>Reply</span></a></li>
		                                                </ul>
		                                            </div>
		                                        </div>
		                                        <!-- /row -->
		                                        <div class="row reply">
		                                            <div class="col-md-2 user_info">
		                                                <figure><img src="/img/avatar.jpg" alt=""></figure>
		                                            </div>
		                                            <div class="col-md-10">
		                                                <div class="review_content">
		                                                    <strong>Reply from Foogra</strong>
		                                                    <em>Published 3 minutes ago</em>
		                                                    <p><br>Hi Monika,<br><br>Eos tollit ancillae ea, lorem consulatu qui ne, eu eros eirmod scaevola sea. Et nec tantas accusamus salutatus, sit commodo veritus te, erat legere fabulas has ut. Rebum laudem cum ea, ius essent fuisset ut. Viderer petentium cu his. Tollit molestie suscipiantur his et.<br><br>Thanks</p>
		                                                </div>
		                                            </div>
		                                        </div>
		                                        <!-- /reply -->
		                                    </div>
		                                    <!-- /review_card -->
		                                </div>
		                                <!-- /reviews -->
		                                <div class="text-end"><a href="leave-review.html" class="btn_1">Leave a review</a></div>
		                            </div>
		                        </div>
		                    </div>
		                </div>
		                <!-- /tab-content -->
		            </div>
		            <!-- /tabs_detail -->
		        </div>
		        <!-- /col -->

		        <div class="col-lg-4" id="sidebar_fixed">
		            <div class="box_booking">
		                <div class="head">
		                    <h3>Book your table</h3>
		                    <div class="offer">Up to -40% off</div>
		                </div>
		                <!-- /head -->
		                <div class="main">
		                    <input type="text" id="datepicker_field">
		                    <div id="DatePicker"></div>
		                    <div class="dropdown time">
		                        <a href="#" data-bs-toggle="dropdown">Hour <span id="selected_time"></span></a>
		                        <div class="dropdown-menu">
		                            <div class="dropdown-menu-content">
		                                <h4>Lunch</h4>
		                                <div class="radio_select add_bottom_15">
		                                    <ul>
		                                        <li>
		                                            <input type="radio" id="time_1" name="time" value="12.00am">
		                                            <label for="time_1">12.00<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="time_2" name="time" value="08.30pm">
		                                            <label for="time_2">12.30<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="time_3" name="time" value="09.00pm">
		                                            <label for="time_3">1.00<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="time_4" name="time" value="09.30pm">
		                                            <label for="time_4">1.30<em>-40%</em></label>
		                                        </li>
		                                    </ul>
		                                </div>
		                                <!-- /time_select -->
		                                <h4>Dinner</h4>
		                                <div class="radio_select">
		                                    <ul>
		                                        <li>
		                                            <input type="radio" id="time_5" name="time" value="08.00pm">
		                                            <label for="time_1">20.00<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="time_6" name="time" value="08.30pm">
		                                            <label for="time_2">20.30<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="time_7" name="time" value="09.00pm">
		                                            <label for="time_3">21.00<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="time_8" name="time" value="09.30pm">
		                                            <label for="time_4">21.30<em>-40%</em></label>
		                                        </li>
		                                    </ul>
		                                </div>
		                                <!-- /time_select -->
		                            </div>
		                        </div>
		                    </div>
		                    <!-- /dropdown -->
		                    <div class="dropdown people">
		                        <a href="#" data-bs-toggle="dropdown">People <span id="selected_people"></span></a>
		                        <div class="dropdown-menu">
		                            <div class="dropdown-menu-content">
		                                <h4>How many people?</h4>
		                                <div class="radio_select">
		                                    <ul>
		                                        <li>
		                                            <input type="radio" id="people_1" name="people" value="1">
		                                            <label for="people_1">1<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="people_2" name="people" value="2">
		                                            <label for="people_2">2<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="people_3" name="people" value="3">
		                                            <label for="people_3">3<em>-40%</em></label>
		                                        </li>
		                                        <li>
		                                            <input type="radio" id="people_4" name="people" value="4">
		                                            <label for="people_4">4<em>-40%</em></label>
		                                        </li>
		                                    </ul>
		                                </div>
		                                <!-- /people_select -->
		                            </div>
		                        </div>
		                    </div>
		                    <!-- /dropdown -->
		                    <a href="#0" class="btn_1 full-width mb_5">Reserve Now</a>
		                    <a href="wishlist.html" class="btn_1 full-width outline wishlist"><i class="icon_heart"></i> Add to wishlist</a>
		                </div>
		            </div>
		            <!-- /box_booking -->
		            <ul class="share-buttons">
		                <li><a class="fb-share" href="#0"><i class="social_facebook"></i> Share</a></li>
		                <li><a class="twitter-share" href="#0"><i class="social_twitter"></i> Share</a></li>
		                <li><a class="gplus-share" href="#0"><i class="social_googleplus"></i> Share</a></li>
		            </ul>
		        </div>

		    </div>
		    <!-- /row -->
		</div>
		<!-- /container -->
		
	</main>
	<!-- /main -->

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const tabC = document.getElementById("tab-C");
			const paneC = document.getElementById("pane-C");
			const storeId = document.getElementById("store-id").value; // storeId를 숨겨놓고 가져옴

			let menuLoaded = false; // 중복 요청 방지

			tabC.addEventListener("click", () => {
				if (menuLoaded) return; // 이미 로드된 경우는 생략
				fetch(`/store/detail/${storeId}/menuList`)
					.then(response => {
						if (!response.ok) throw new Error("Menu tab load failed");
						return response.text();
					})
					.then(html => {
						paneC.innerHTML = html;
						initMenuFilter();
						menuLoaded = true;
					})
					.catch(err => {
						console.error(err);
					});
			});

			function initMenuFilter() {
				const tagEls = paneC.querySelectorAll(".filter-tag");
				const menuEls = paneC.querySelectorAll(".menu_card");

				if (tagEls.length === 0 || menuEls.length === 0) return;

				const activeFilters = {
					category: new Set(),
					soup: new Set(),
					topping: new Set()
				};

				tagEls.forEach(tag => {
					const type = tag.dataset.type;
					const value = tag.dataset.value;
					activeFilters[type].add(value);
				});

				tagEls.forEach(tag => {
					tag.addEventListener("click", () => {
						const type = tag.dataset.type;
						const value = tag.dataset.value;

						tag.classList.toggle("inactive");

						if (activeFilters[type].has(value)) {
							activeFilters[type].delete(value);
						} else {
							activeFilters[type].add(value);
						}

						filterMenus();
					});
				});

				function filterMenus() {
					menuEls.forEach(menu => {
						const category = menu.dataset.category;
						const soup = menu.dataset.soup;
						const toppings = (menu.dataset.toppings || "").split(",");

						const categoryMatch = activeFilters.category.size === 0 || activeFilters.category.has(category);
						const soupMatch = activeFilters.soup.size === 0 || activeFilters.soup.has(soup);
						const toppingMatch = activeFilters.topping.size === 0 || toppings.some(t => activeFilters.topping.has(t.trim()));

						if (categoryMatch && soupMatch && toppingMatch) {
							menu.style.display = "";
						} else {
							menu.style.display = "none";
						}
					});
				}
			}
		});
	</script>
	<!-- menu-tab 실행 -->


	<!-- footer -->
	<th:block th:replace="~{fragments/footer :: footer}"></th:block>

	<div id="toTop"></div><!-- Back to top button -->
	
	<div class="layer"></div><!-- Opacity Mask Menu Mobile -->
	
	<!-- Sign In Modal -->
	<th:block th:replace="~{store/signin-modal :: signin-modal}"></th:block>

	<!-- COMMON SCRIPTS -->
    <script src="/js/common_scripts.min.js"></script>
    <script src="/js/common_func.js"></script>
    <script src="/assets/validate.js"></script>
    
    <!-- SPECIFIC SCRIPTS -->
    <script src="/js/sticky_sidebar.min.js"></script>
    <script src="/js/specific_detail.js"></script>
	<script src="/js/datepicker.min.js"></script>
	<script src="/js/datepicker_func_1.js"></script>

</body>
</html>