<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <th:block th:replace="~{fragments/head :: head}"></th:block>
    <!-- SPECIFIC CSS -->
  <link th:href="@{/css/home.css}" rel="stylesheet">
</head>

<body>
<div th:replace="~{fragments/mainHeader :: mainHeader}"></div>

<main>
  <div class="hero_single version_2">
    <div class="opacity-mask" data-opacity-mask="rgba(0, 0, 0, 0.6)">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-xl-9 col-lg-10 col-md-8">
            <h1>Discover &amp; Book</h1>
            <p>The best restaurants at the best price</p>
            <form method="post" action="grid-listing-filterscol.html">
              <div class="row g-0 custom-search-input">
                <div class="col-lg-4">
                  <div class="form-group">
                    <input class="form-control" type="text" placeholder="What are you looking for...">
                    <i class="icon_search"></i>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <input class="form-control no_border_r" type="text" placeholder="Address, neighborhood...">
                    <i class="icon_pin_alt"></i>
                  </div>
                </div>
                <div class="col-lg-2">
                  <input type="submit" value="Search">
                </div>
              </div>
              <!-- /row -->
            </form>
          </div>
        </div>
        <!-- /row -->
      </div>
    </div>
  </div>
  <!-- /hero_single -->
  <div class="bg_gray">
    <div class="container margin_60_40">
      <div class="main_title center">
        <span><em></em></span>
        <h2>Popular Categories</h2>
        <p>Cum doctus civibus efficiantur in imperdiet deterruisset</p>
      </div>
      <!-- /main_title -->
      <div class="owl-carousel owl-theme categories_carousel">
        <div class="item">
          <a href="#0">
            <span>98</span>
            <i class="icon-food_icon_pizza"></i>
            <h3>Pizza - Italian</h3>
            <small>Avg price $40</small>
          </a>
        </div>
        <div class="item">
          <a href="#0">
            <span>87</span>
            <i class="icon-food_icon_sushi"></i>
            <h3>Japanese - Sushi</h3>
            <small>Avg price $50</small>
          </a>
        </div>
        <div class="item">
          <a href="#0">
            <span>96</span>
            <i class="icon-food_icon_burgher"></i>
            <h3>Burghers</h3>
            <small>Avg price $55</small>
          </a>
        </div>
        <div class="item">
          <a href="#0">
            <span>78</span>
            <i class="icon-food_icon_vegetarian"></i>
            <h3>Vegetarian</h3>
            <small>Avg price $40</small>
          </a>
        </div>
        <div class="item">
          <a href="#0">
            <span>65</span>
            <i class="icon-food_icon_cake_2"></i>
            <h3>Bakery</h3>
            <small>Avg price $60</small>
          </a>
        </div>
        <div class="item">
          <a href="#0">
            <span>65</span>
            <i class="icon-food_icon_chinese"></i>
            <h3>Chinese</h3>
            <small>Avg price $40</small>
          </a>
        </div>
        <div class="item">
          <a href="#0">
            <span>65</span>
            <i class="icon-food_icon_burrito"></i>
            <h3>Mexican</h3>
            <small>Avg price $35</small>
          </a>
        </div>
      </div>
      <!-- /carousel -->
    </div>
    <!-- /container -->
  </div>
  <!-- /bg_gray -->
</main>

<section class="my-store-list container margin_60_40">
  <h2>내가 등록한 매장</h2>

  <div th:if="${#lists.isEmpty(myStores)}">
    <p>등록한 매장이 없습니다.</p>
  </div>

  <div class="store-cards" th:if="${!#lists.isEmpty(myStores)}">
    <div class="store-card" th:each="store : ${myStores}">
      <h3 th:text="${store.storeName}">매장명</h3>
      <p th:text="${store.address}">매장 주소</p>

      <!-- 수정 버튼 -->
      <button class="btn btn-outline-primary btn-sm">수정</button>

      <!-- 폐업 버튼 -->
      <button class="btn btn-outline-danger btn-sm"
              type="button"
              th:onclick="|deleteStore(${store.id})|">
        폐업
      </button>
    </div>
  </div>
</section>

<div th:replace="~{fragments/footer :: footer}"></div>

<div id="toTop"></div><!-- Back to top button -->

<!-- COMMON SCRIPTS -->
<script th:src="@{/js/common_scripts.min.js}"></script>
<script th:src="@{/js/common_func.js}"></script>
<script th:src="@{/assets/validate.js}"></script>

<script>
  function deleteStore(storeId) {
    if (!confirm("폐업하시겠습니까?")) return;

    fetch(`/mypage/store/delete/${storeId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      },
    })
            .then(res => {
              if (!res.ok) {
                res.text().then(txt => console.error("서버 응답:", txt));
                throw new Error('삭제 실패');
              }
              alert('폐업된 매장으로 전환하였습니다.');
              window.location.reload();
            })
            .catch(e => {
              alert('삭제 중 오류가 발생했습니다.');
              console.error(e);
            });
  }
</script>

</body>
</html>